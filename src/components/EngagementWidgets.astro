<div class="engagement" aria-hidden="true">
  <!-- Exit Intent Modal -->
  <div class="exit-intent" id="exit-intent" hidden>
    <div class="exit-intent__backdrop" data-close="exit"></div>
    <div class="exit-intent__dialog" role="dialog" aria-modal="true" aria-labelledby="exit-title">
      <button class="exit-intent__close" type="button" data-close="exit" aria-label="Close">
        ×
      </button>
      <p class="exit-intent__badge">Quick question</p>
      <h2 class="exit-intent__title" id="exit-title">Before you go — want a clear 60‑second plan?</h2>
      <p class="exit-intent__text">
        Book a <strong>₹299</strong> consultation and get a straightforward, risk-aware path across crypto, stocks, and mutual funds.
      </p>
      <div class="exit-intent__actions">
        <a class="btn btn-primary" href="/#contact">Book ₹299 Consultation</a>
        <button class="btn btn-secondary" type="button" data-close="exit">Not now</button>
      </div>
      <p class="exit-intent__fineprint">This appears at most once per day.</p>
    </div>
  </div>

  <!-- Reminder Toast -->
  <div class="reminder" id="reminder" hidden>
    <div class="reminder__card" role="status" aria-live="polite">
      <div class="reminder__content">
        <p class="reminder__title">Need help picking the right path?</p>
        <p class="reminder__text">
          Get a simple plan in one consult — <strong>₹299</strong>.
        </p>
      </div>
      <div class="reminder__actions">
        <a class="reminder__btn reminder__btn--primary" href="/#contact">Book</a>
        <button class="reminder__btn" type="button" data-close="reminder">Dismiss</button>
      </div>
    </div>
  </div>
</div>

<style>
  .exit-intent {
    position: fixed;
    inset: 0;
    z-index: 9998;
  }

  .exit-intent__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(2, 6, 23, 0.66);
    backdrop-filter: blur(6px);
  }

  .exit-intent__dialog {
    position: relative;
    width: min(560px, calc(100vw - 32px));
    margin: 10vh auto 0;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    padding: var(--space-8);
  }

  .exit-intent__close {
    position: absolute;
    top: 10px;
    right: 12px;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    border: 1px solid var(--color-border);
    background: var(--color-bg-secondary);
    font-size: 22px;
    line-height: 1;
    color: var(--color-text-primary);
  }

  .exit-intent__badge {
    display: inline-flex;
    padding: 6px 10px;
    border-radius: var(--radius-full);
    background: color-mix(in srgb, var(--color-brand-accent) 14%, var(--color-bg-secondary));
    color: var(--color-text-primary);
    border: 1px solid color-mix(in srgb, var(--color-brand-accent) 25%, var(--color-border));
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    margin-bottom: var(--space-4);
  }

  .exit-intent__title {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-3);
  }

  .exit-intent__text {
    color: var(--color-text-secondary);
    line-height: 1.8;
    margin-bottom: var(--space-6);
  }

  .exit-intent__actions {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    align-items: center;
  }

  .exit-intent__fineprint {
    margin-top: var(--space-5);
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  /* Reminder toast */
  .reminder {
    position: fixed;
    left: 16px;
    bottom: 16px;
    z-index: 9997;
    width: min(380px, calc(100vw - 32px));
  }

  .reminder__card {
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
    padding: 12px 12px 12px 14px;
    border-radius: 14px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid rgba(255, 255, 255, 0.14);
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);
    color: #fff;
  }

  .reminder__title {
    font-weight: 800;
    font-size: 13px;
    margin: 0 0 2px;
  }

  .reminder__text {
    font-size: 12px;
    opacity: 0.9;
    margin: 0;
  }

  .reminder__actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .reminder__btn {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.06);
    color: #fff;
    font-weight: 700;
    font-size: 12px;
    text-decoration: none;
  }

  .reminder__btn--primary {
    background: rgba(45, 140, 240, 0.25);
    border-color: rgba(45, 140, 240, 0.35);
  }

  @media (min-width: 1024px) {
    .reminder {
      left: auto;
      right: 16px;
    }
  }
</style>

<script>
  (function () {
    const DAY_KEY = new Date().toISOString().slice(0, 10);
    const exitKey = `irise_exit_intent_${DAY_KEY}`;
    const reminderKey = `irise_reminder_${DAY_KEY}`;

    const exitEl = document.getElementById('exit-intent');
    const reminderEl = document.getElementById('reminder');

    const isTouch =
      'ontouchstart' in window ||
      navigator.maxTouchPoints > 0;

    function openExit() {
      if (!exitEl) return;
      exitEl.hidden = false;
      document.body.style.overflow = 'hidden';
      try { localStorage.setItem(exitKey, '1'); } catch {}
      // focus close for accessibility
      (exitEl.querySelector('[data-close="exit"]') as HTMLElement)?.focus();
    }

    function closeExit() {
      if (!exitEl) return;
      exitEl.hidden = true;
      document.body.style.overflow = '';
    }

    function openReminder() {
      if (!reminderEl) return;
      reminderEl.hidden = false;
      try { localStorage.setItem(reminderKey, '1'); } catch {}
    }

    function closeReminder() {
      if (!reminderEl) return;
      reminderEl.hidden = true;
    }

    // Close handlers
    document.addEventListener('click', (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      const closeType = t.getAttribute('data-close');
      if (closeType === 'exit') closeExit();
      if (closeType === 'reminder') closeReminder();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeExit();
        closeReminder();
      }
    });

    // Exit intent (desktop only)
    if (!isTouch) {
      let already = false;
      document.addEventListener('mouseleave', (e) => {
        if (already) return;
        if (e.clientY > 0) return;
        try {
          if (localStorage.getItem(exitKey)) return;
        } catch {}
        already = true;
        openExit();
      });
    }

    // Reminder toast (all devices), but rate-limited
    window.setTimeout(() => {
      try {
        if (localStorage.getItem(reminderKey)) return;
      } catch {}
      // Don't show if user is already at contact anchor
      if (window.location.hash === '#contact') return;
      openReminder();
      // auto-hide after 12s if not interacted
      window.setTimeout(() => {
        closeReminder();
      }, 12000);
    }, 45000);
  })();
</script>


